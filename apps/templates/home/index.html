<!-- templates/home/result.html -->
{% extends "layouts/base.html" %}

{% block title %} Prediction Result {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
    <!-- Add any specific stylesheets for the result page if needed -->
    <style>
        canvas {
            max-width: 100%; /* Make the chart responsive to the container width */
            margin: 20px 0; /* Add some margin for better spacing */
        }
    </style>
{% endblock stylesheets %}

{% block content %}

    <div class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-chart">
                    <div class="card-header">
                        <h5 class="card-category">Price Chart</h5>
                        <h2 class="card-title"></h2>
                    </div>
                    <div class="card-body">
                        <div class="chart-area">
                            <canvas id="predictionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
    // Function to fetch prediction data from Flask route
    async function fetchPredictionData() {
        try {
            const response = await fetch('/get_prediction_data');
            if (!response.ok) {
                throw new Error('Error fetching prediction data');
            }
            const data = await response.json();
            return data;
        } catch (error) {
            console.error(error);
            throw error;
        }
    }

    // Function to create and update the chart
    async function createChart() {
        try {
            // Fetch prediction data from Flask route
            const data = await fetchPredictionData();

            // Chart configuration
            const chartConfig = {
                type: 'line',
                data: {
                    labels: data.map(entry => entry.DATE),
                    datasets: [{
                        label: 'COPRA PRICE',
                        data: data.map(entry => parseFloat(entry.PRICE)),
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 2,
                        pointRadius: 4,
                        pointBackgroundColor: 'rgba(75, 192, 192, 1)',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM D'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price (PHP per kg)'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                }
            };

            // Get chart canvas and create Chart instance
            const ctx = document.getElementById('predictionChart').getContext('2d');
            const myChart = new Chart(ctx, chartConfig);

        } catch (error) {
            console.error('Error creating chart:', error);
        }
    }

    // Call createChart function when the page loads
    document.addEventListener('DOMContentLoaded', createChart);

</script>

{% endblock javascripts %}
